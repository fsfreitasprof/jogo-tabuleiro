<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorte ou Azar?</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
/* O CSS (style) é exatamente o mesmo de antes. */
:root {
    --cor-bg: #f1f5f9;
    --cor-card: #ffffff;
    --cor-botao: #2563eb;
}
body {
    font-family: 'Press Start 2P', cursive;
    background-color: var(--cor-bg);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    transition: background-color 0.5s;
}
.card {
    background-color: var(--cor-card);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    text-align: center;
    width: 90%;
    max-width: 400px;
}
h1 {
    font-size: 1.6rem;
    margin-bottom: 20px;
    color: #111827;
}
button {
    background: var(--cor-botao);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 15px;
    font-size: 0.8rem;
    cursor: pointer;
    width: 100%;
    transition: all 0.3s;
}
button:hover {
    opacity: 0.9;
}
button:disabled {
    background-color: #9ca3af;
    cursor: not-allowed;
}
#resultado {
    margin-top: 25px;
    font-size: 1rem;
    min-height: 2em;
    font-family: Arial, sans-serif;
    transition: all 0.3s;
}
</style>
</head>
<body>
<div class="card">
    <h1>Sorte ou Azar?</h1>
    <button id="btn" onclick="sortear()">Sortear</button>
    <div id="resultado"></div>
</div>

<script>
// ATUALIZAÇÃO FORÇADA (Cache Buster)
async function carregarJSON(caminho) {
    const resp = await fetch(caminho + "?v=" + Date.now());
    if (!resp.ok) throw new Error("Falha ao carregar: " + caminho);
    return resp.json();
}

// Lista de Fallback (Plano B)
const eventosFallback = [
    { evento: "Volte 3 casas", cor: "vermelho" },
    { evento: "Avance 3 casas", cor: "verde" },
    { evento: "Volte para o começo", cor: "amarelo" },
    { evento: "Jogue novamente sem precisar responder outra pergunta", cor: "amarelo" }
];

let roletaInterval;

// Função para iniciar a roleta (Req 1)
function iniciarRoleta(listaEventos) {
    const listaStrings = listaEventos.map(item => (typeof item === 'string' ? item : item.evento));
    const resultadoEl = document.getElementById('resultado');
    if (roletaInterval) clearInterval(roletaInterval);

    roletaInterval = setInterval(() => {
        const eventoAleatorio = listaStrings[Math.floor(Math.random() * listaStrings.length)];
        resultadoEl.innerText = eventoAleatorio;
    }, 50); // Gira rápido
}

// Função para definir a cor final
function definirCor(cor) {
    const botao = document.getElementById('btn');
    if (cor === 'verde') {
        document.body.style.backgroundColor = "#16a34a";
        botao.style.backgroundColor = "#15803d";
    } else if (cor === 'vermelho') {
        document.body.style.backgroundColor = "#dc2626";
        botao.style.backgroundColor = "#b91c1c";
    } else { // amarelo ou fallback
        document.body.style.backgroundColor = "#facc15";
        botao.style.backgroundColor = "#ca8a04";
    }
}

async function sortear() {
    const botao = document.getElementById('btn');
    const resultadoEl = document.getElementById('resultado');
    
    // Desabilita o botão para evitar cliques duplos
    botao.disabled = true;
    resultadoEl.innerText = ""; 

    let corFinal;
    let eventoFinal;
    let listaRoleta;

    try {
        // --- Início do Caminho Feliz (try) ---
        const config = await carregarJSON("config.json");
        const probabilidades = config.probabilidades;
        const selecoes = config.listas_ativas;

        const [verde, vermelho, amarelo] = await Promise.all([
            carregarJSON("eventos/verde.json"),
            carregarJSON("eventos/vermelho.json"),
            carregarJSON("eventos/amarelo.json")
        ]);

        const cores = { verde, vermelho, amarelo };
        
        let eventosGlobais = [];
        for (const cor in selecoes) {
            selecoes[cor].forEach(listaNome => {
                if (cores[cor] && cores[cor][listaNome]) {
                    eventosGlobais = eventosGlobais.concat(cores[cor][listaNome]);
                }
            });
        }
        
        if (eventosGlobais.length === 0) {
            throw new Error("Nenhuma lista de evento ativa."); // Joga para o catch
        }
        
        listaRoleta = eventosGlobais;

        const total = probabilidades.verde + probabilidades.vermelho + probabilidades.amarelo;
        const rand = Math.random() * total;
        
        if (rand < probabilidades.verde) corFinal = "verde";
        else if (rand < probabilidades.verde + probabilidades.vermelho) corFinal = "vermelho";
        else corFinal = "amarelo";

        let eventosDaCor = [];
        selecoes[corFinal].forEach(lista => {
            if (cores[corFinal][lista]) {
                eventosDaCor = eventosDaCor.concat(cores[corFinal][lista]);
            }
        });
        
        eventoFinal = eventosDaCor[Math.floor(Math.random() * eventosDaCor.length)];

    } catch (error) {
        // --- Início do Fallback (catch) ---
        console.error("Falha ao carregar JSONs, usando fallback:", error); 
        listaRoleta = eventosFallback;
        const sorteio = eventosFallback[Math.floor(Math.random() * eventosFallback.length)];
        corFinal = sorteio.cor;
        eventoFinal = sorteio.evento;
    }

    // --- Início da Exibição (Comum aos dois caminhos) ---

    // 1. Inicia a roleta
    iniciarRoleta(listaRoleta);

    // 2. Espera 2 segundos
    setTimeout(() => {
        // 3. Para a roleta
        clearInterval(roletaInterval);

        // 4. Define a cor e o resultado final
        definirCor(corFinal);
        resultadoEl.innerText = eventoFinal;

        // 5. *** AQUI ESTÁ A MUDANÇA ***
        // Altera o botão para recarregar a página
        botao.innerText = "Quer sortear novamente?";
        
        // Remove o 'onclick' antigo e adiciona o novo
        botao.onclick = function() {
            location.reload(); 
        };
        
        // Reabilita o botão (agora com a nova função)
        botao.disabled = false;
        
    }, 2000); // 2000ms = 2 segundos
}
</script>
</body>
</html>
