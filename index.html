<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorte ou Azar?</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root {
    --cor-bg: #f1f5f9;
    --cor-card: #ffffff;
    --cor-botao: #2563eb;
}

body {
    font-family: 'Press Start 2P', cursive;
    background-color: var(--cor-bg);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    transition: background-color 0.5s;
}

.card {
    background-color: var(--cor-card);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    text-align: center;
    width: 90%;
    max-width: 400px;
}

h1 {
    font-size: 1.6rem;
    margin-bottom: 20px;
    color: #111827;
}

button {
    background: var(--cor-botao);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 15px;
    font-size: 0.8rem;
    cursor: pointer;
    width: 100%;
    transition: all 0.3s;
}

button:hover {
    opacity: 0.9;
}

#resultado {
    margin-top: 25px;
    font-size: 1rem;
    min-height: 2em;
    font-family: Arial, sans-serif;
    transition: all 0.3s;
}
</style>
</head>
<body>
<div class="card">
    <h1>Sorte ou Azar?</h1>
    <button id="btn" onclick="sortear()">Sortear</button>
    <div id="resultado"></div>
</div>

<script>
async function carregarConfig() {
    const res = await fetch("config.json?v=" + Date.now());
    return await res.json();
}

async function carregarEventos(cor, arquivos) {
    const eventos = [];
    for (const arquivo of arquivos) {
        const resp = await fetch(`eventos/${cor}/${arquivo}?v=${Date.now()}`);
        const texto = await resp.text();
        const linhas = texto.split("\n").map(l => l.trim()).filter(l => l);
        eventos.push(...linhas);
    }
    return eventos;
}

async function sortear() {
    const resultadoEl = document.getElementById("resultado");
    const botao = document.getElementById("btn");

    const config = await carregarConfig();
    const { probabilidades, listas } = config;

    const total = probabilidades.verde + probabilidades.vermelho + probabilidades.amarelo;
    const r = Math.random() * total;
    let cor;
    if (r < probabilidades.verde) cor = "verde";
    else if (r < probabilidades.verde + probabilidades.vermelho) cor = "vermelho";
    else cor = "amarelo";

    const arquivos = listas[cor];
    const eventos = await carregarEventos(cor, arquivos);
    const eventoSorteado = eventos[Math.floor(Math.random() * eventos.length)];

    resultadoEl.innerText = "Sorteando...";
    let contador = 0;
    const iteracoes = 20;
    const intervalo = 80;

    const anim = setInterval(() => {
        resultadoEl.innerText = eventos[Math.floor(Math.random() * eventos.length)];
        contador++;
        if (contador >= iteracoes) {
            clearInterval(anim);
            resultadoEl.innerText = eventoSorteado;

            if (cor === "verde") {
                document.body.style.backgroundColor = "#16a34a";
                botao.style.backgroundColor = "#15803d";
            } else if (cor === "vermelho") {
                document.body.style.backgroundColor = "#dc2626";
                botao.style.backgroundColor = "#b91c1c";
            } else {
                document.body.style.backgroundColor = "#facc15";
                botao.style.backgroundColor = "#ca8a04";
            }
        }
    }, intervalo);
}
</script>
</body>
</html>
