<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sorte ou Azar</title>
  <style>
    body {
      background-color: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
    }
    button {
      padding: 12px 24px;
      margin-top: 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #resultado {
      margin-top: 30px;
      font-size: 22px;
    }
  </style>
</head>
<body>
  <h1>Sorte ou Azar?</h1>
  <button id="sortear">Sortear</button>
  <div id="resultado"></div>

  <script>
    async function carregarConfig() {
      const localConfig = localStorage.getItem("config");
      if (localConfig) return JSON.parse(localConfig);

      const resp = await fetch("config.json?v=" + Date.now());
      return await resp.json();
    }

    async function carregarListas() {
      const resp = await fetch("eventos/lista.json?v=" + Date.now());
      return await resp.json();
    }

    async function carregarArquivo(caminho) {
      const resp = await fetch(caminho + "?v=" + Date.now());
      return await resp.text();
    }

    async function sortear() {
      const config = await carregarConfig();
      const listas = await carregarListas();

      const total = config.verde + config.vermelho + config.amarelo;
      const rand = Math.random() * total;

      let cor;
      if (rand < config.verde) cor = "verde";
      else if (rand < config.verde + config.vermelho) cor = "vermelho";
      else cor = "amarelo";

      // Carrega os arquivos selecionados
      const selecoes = JSON.parse(localStorage.getItem("selecoes") || "{}");
      const selecionados = selecoes[cor] || ["padrao.txt"];

      // Junta todos os eventos das listas selecionadas
      let eventos = [];
      for (const arquivo of selecionados) {
        const conteudo = await carregarArquivo(`eventos/${cor}/${arquivo}`);
        eventos.push(...conteudo.split("\n").filter(l => l.trim() !== ""));
      }

      const evento = eventos[Math.floor(Math.random() * eventos.length)];
      document.getElementById("resultado").innerHTML =
        `<strong style="color:${cor}">${cor.toUpperCase()}</strong>: ${evento}`;
    }

    document.getElementById("sortear").addEventListener("click", sortear);
  </script>
</body>
</html>
